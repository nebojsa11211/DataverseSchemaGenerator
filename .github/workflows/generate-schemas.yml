name: Dataverse Auto Schema Generator

on:
  push:
    paths:
      - 'Input/*.xml' # Pokreće se samo kad dodaš XML datoteku

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Nužno za 'git push' natrag u repo

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: Restore and Build
      run: dotnet build DataverseSchemaGenerator.sln

    - name: Run Batch Generation
      # Koristi --batch za unikatna imena i arhiviranje u Input/Archive/
      run: dotnet run --project DataverseSchemaGenerator -- --batch --out ./Output

    - name: Commit and Push Results
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add Output/
        git add Input/Archive/
        git commit -m "Automated schema update: $(date +'%d-%m-%y %H:%M:%S')" || echo "No changes"
        git push
