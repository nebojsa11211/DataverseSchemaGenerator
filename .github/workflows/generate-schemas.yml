name: Dataverse Auto Schema Generator

on:
  push:
    paths:
      - 'Input/*.xml' 

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write 

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: Restore and Build
      # Buildamo samo Console projekt kako bismo izbjegli Windows-only WPF grešku
      run: dotnet build DataverseSchemaGenerator/DataverseSchemaGenerator.csproj

    - name: Run Batch Generation
      # Pokrećemo Console projekt s batch parametrima
      run: dotnet run --project DataverseSchemaGenerator/DataverseSchemaGenerator.csproj -- --batch --out ./Output

    - name: Commit and Push Results
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add Output/
        git add Input/Archive/
        git commit -m "Automated schema update: $(date +'%d-%m-%y %H:%M:%S')" || echo "No changes"
        git push
